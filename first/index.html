<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">   
    <link rel="shortcut icon" href="../img/favicon.ico">

    <title>Premier pas - LP Symfony2</title>

    <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/font-hack/2.015/css/hack.min.css">
    <link href='//fonts.googleapis.com/css?family=PT+Sans:400,400italic,700,700italic&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,400,300,600,700&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href="../css/base.css" rel="stylesheet">
    <link href="../css/cinder.css" rel="stylesheet">
    <link rel="stylesheet" href="../css/highlight.css">


    <link href="../css/main.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

    <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.5.18/webfont.js"></script>
    <script>
    WebFont.load({
        google: {
            families: ['Open Sans', 'PT Sans']
        }
    });
    </script>

    
</head>

<body>

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="..">LP Symfony2</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="..">Installation</a>
                    </li>
                
                
                
                    <li class="active">
                        <a href="./">Premier pas</a>
                    </li>
                
                
                
                    <li >
                        <a href="../crm/">TP CRM</a>
                    </li>
                
                
                
                    <li >
                        <a href="../help/">Aide</a>
                    </li>
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                
                    <li >
                        <a rel="next" href="..">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../crm/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                
                
            </ul>
        </div>
    </div>
</div>

    <div class="container">
        
        <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#introduction">Introduction</a></li>
        
    
        <li class="main "><a href="#creation-du-bundle">Création du bundle</a></li>
        
    
        <li class="main "><a href="#creation-dun-controller">Création d'un controller</a></li>
        
            <li><a href="#class-controller">Class Controller</a></li>
        
            <li><a href="#gestion-des-parametres-en-annotation">Gestion des paramètres en annotation</a></li>
        
    
        <li class="main "><a href="#gestion-du-templating">Gestion du templating</a></li>
        
            <li><a href="#localise-un-template-partial">Localisé un template partial</a></li>
        
            <li><a href="#gestion-dun-layout">Gestion d'un layout</a></li>
        
            <li><a href="#par-exemple">Par exemple</a></li>
        
            <li><a href="#creer-son-layout">Créer son layout</a></li>
        
            <li><a href="#lien">Lien</a></li>
        
            <li><a href="#web-assets">Web Assets</a></li>
        
    
        <li class="main "><a href="#doctrine">Doctrine</a></li>
        
    
        <li class="main "><a href="#form">Form</a></li>
        
    
    </ul>
</div></div>
        <div class="col-md-9" role="main">

<h1 id="introduction">Introduction</h1>
<p>Nous allons créer un premier bundle <code>TestBundle</code> afin de prendre en main le paradigme MVC dans une structure 
Symfony2.</p>
<p>Process :</p>
<ol>
<li>Création d'un bundle</li>
<li>Création d'un controller de Test</li>
<li>Création d'une action</li>
<li>Templating d'une action</li>
<li>Templating d'un layout<ol>
<li>HTML</li>
<li>CSS / Assets</li>
</ol>
</li>
</ol>
<h1 id="creation-du-bundle">Création du bundle</h1>
<p>Pour cela nous allons utliser une ligne de commande qui va nous permettre de générer un skeleton de Bundle.</p>
<p><em>Cette commande n'est à effectuer qu'en environnement de developpement</em></p>
<pre><code>$ app/console generate:bundle
</code></pre>

<p>Un certain nombre d'informations seront nécessaires :</p>
<ol>
<li>Namespace<ol>
<li>Vendor / Créateur - <code>Lp</code></li>
<li>Nom du bundle - <code>Test</code></li>
<li>Suffixe obligatoire - <code>Bundle</code></li>
<li>Donc <code>Lp/TestBundle</code></li>
</ol>
</li>
<li>Choisir le nom - Par convention on utilise la définition du namespace sans slash</li>
<li>Choisir la destination - <code>src/</code> car bundle application métier</li>
<li>Format de configuration - Prendre <code>annotation</code></li>
<li>Structure à générer - <code>no</code></li>
<li>Confirmation</li>
</ol>
<p><strong>Que s'est-il passé ?</strong></p>
<p>Il faut se rendre dans le répertoire <code>src/Lp/TestBundle</code> afin de voir que des fichiers ont été généré.</p>
<ol>
<li>Fichier <code>LpTestBundle.php</code> qui est le seul fichier obligatoire afin de charger le bundle dans le Kernel</li>
<li>Autochargement dans le <code>AppKernel</code></li>
<li>Enregistrement de la définition de nos routes dans <code>src/Lp/TestBundle/Resources/config/routing.yml</code></li>
</ol>
<h1 id="creation-dun-controller">Création d'un controller</h1>
<p>Dans un controller nommé <code>DemoController</code>, il nous faut différentes actions :</p>
<ol>
<li><code>index</code> : qui permet d'afficher un texte statique</li>
<li><code>whatsMyName</code> : qui permet d'afficher une information en variable d'URL</li>
</ol>
<p>Pour chacune de ses actions créer un template propre.</p>
<h2 id="class-controller">Class Controller</h2>
<p>Une Class Controller permet de gérer différentes actions appelées par le routing.</p>
<p>Lors de la génération du skeleton de notre bundle, nous avons un répertoire <code>Controller</code>. Si nous observons 
le fichier de routing de notre application 'app/config/routing.yml', on constate que nous chargeons toutes les actions
paramétrées dans les class se trouvant dans le dossier <code>Controller</code></p>
<pre><code>lp_test:
    resource: "@LpTestBundle/Controller/"
    type:     annotation
    prefix:   /

app:
    resource: "@AppBundle/Controller/"
    type:     annotation
</code></pre>
<p>Donc il suffit de créer la Class ci-dessous dans un fichier nommé <code>DemoController.php</code>(nommage autoload PSR-4) :</p>
<pre><code>&lt;?php

namespace Lp\TestBundle\Controller; # déclaration du namespace

use Symfony\Bundle\FrameworkBundle\Controller\Controller; # import de la Class Controller (héritage)
use Sensio\Bundle\FrameworkExtraBundle\Configuration\Route; # utiliser pour configuration en annotation
use Sensio\Bundle\FrameworkExtraBundle\Configuration\Template; # utiliser pour configuration en annotation

class DemoController extends Controller
{

}
</code></pre>
<p>Et pour créer une action, il suffit d'écrire une méthode annotée dans cette classe </p>
<pre><code>/**
 * @Route("/index", name="_index") # route
 * @Template() # template partial appellé : LpTestBundle:Demo:index.html.twig
 */
public function indexAction()
{
    return array(   # retourne un tableau clé / valeur et les clés sont exposées dans le template
            // ...
        );    
}
</code></pre>
<p>Il existe une commande afin de générer un controller :</p>
<pre><code>$ app/console generate:controller
</code></pre>
<h2 id="gestion-des-parametres-en-annotation">Gestion des paramètres en annotation</h2>
<pre><code> /**
  * @Route("/index/{param}") # route
  * @Template() # template partial appellé : LpTestBundle:Demo:index.html.twig
  */
 public function indexAction($param)
 {
     return array(   # retourne un tableau clé / valeur et les clés sont exposées dans le template
             // ...
         );    
}
</code></pre>
<p>Afin d'indiquer la récupération d'un paramètre, il faut le définir dans le route.
Il est passé en argument de la méthode.</p>
<p><strong>On peut y intégrer l'objet Request</strong></p>
<pre><code>use Symfony\Component\HttpFoundation\Request;

public function indexAction($Request $request)
{
    $page = $request-&gt;query-&gt;get('page', 1);

    // ...
}
</code></pre>
<p><a href="http://symfony.com/doc/current/book/controller.html"><span class="btn btn-info">+ informations</span></a></p>
<h1 id="gestion-du-templating">Gestion du templating</h1>
<p>Le templating dans le framework Symfony est géré par défault avec Twig. </p>
<p>Que ce soit au niveau App ou Bundle, tous les templates se localisent dans <code>Resources/views</code>.</p>
<h2 id="localise-un-template-partial">Localisé un template partial</h2>
<p>A partir d'un controller afin d'éxécuter le rendu de l'action on fait appel à un template. Il est localisé en faisant 
appel à la méthode <code>render()</code> de la class <code>Symfony\Bundle\FrameworkBundle\Controller\Controller</code> dans laquelle est 
injecté le service <code>twig</code> à qui appartient cette fonction et renvoie un object <code>Response</code>.</p>
<p><strong>En PHP</strong></p>
<pre><code>// renders app/Resources/views/hello/greetings/index.html.twig
return $this-&gt;render('hello/greetings/index.html.twig', array(
    'name' =&gt; $name
));
</code></pre>
<p><strong>En Annotation</strong></p>
<pre><code> /**
  * @Template("LpTestBundle:Demo:another.html.twig")
  */
</code></pre>
<h2 id="gestion-dun-layout">Gestion d'un layout</h2>
<p>Par défault, la création du projet génère un template <code>app/Ressources/views/base.html.twig</code> (block mappés) et celui-ci 
peut-être étendu grâce à la fonction twig <code>{% extends ::base.html.twig %}</code></p>
<p>On peut aussi stocké un layout dans nos Bundles. Afin de le localiser il faut utiliser le ShortName du Bundle 
<code>LpTestBundle:layout.html.twig</code> faisant référence au fichier se trouvant dans 
<code>src/Lp/TestBundle/Ressources/views/layout.html.twig</code> </p>
<h2 id="par-exemple">Par exemple</h2>
<p>Nous avons via la définition de notre routing attaqué le controller <code>LpTestBundle:DemoController:indexAction</code> qui par 
défault le rendu va être compilé dans le template <code>LpTestBundle:Demo:index.html.twig</code> qui est localisé dans 
<code>src/Lp/TestBundle/Resources/views/Demo/index.html.twig</code>. Dans ce template partial on fait appel à un layout que nous avons 
crééer dans notre Bundle <code>src/Lp/TestBundle/Resources/views/layout.html.twig</code>.</p>
<pre><code># src/Lp/TestBundle/Resources/views/index.html.twig
{% extends "LpTestBundle:layout.html.twig" %}

{% block title %}LpTestBundle:Demo:index{% endblock %}

{% block body %}
    &lt;h1&gt;Welcome to the Demo:index page&lt;/h1&gt;
{% endblock %}
</code></pre>
<p><a href="http://symfony.com/doc/current/book/templating.html"><span class="btn btn-info">+ informations</span></a></p>
<h2 id="creer-son-layout">Créer son layout</h2>
<p>Faire évoluer le layout en intégrant le <a href="https://getbootstrap.com/examples/starter-template/">starter template bootstrap</a> en mappant 
les zones dynamiques suivantes (block):</p>
<ul>
<li><code>{% block title %}</code> - balise title</li>
<li><code>{% block stylesheets %}</code> - import des JS</li>
<li><code>{% block body %}</code> - corps balise body</li>
<li><code>{% block javascripts %}</code> - import des JS</li>
</ul>
<p><strong>Faire appel via un CDN, les librairies externes (CSS/JS)</strong></p>
<pre><code>&lt;!-- Latest compiled and minified CSS --&gt;
&lt;link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" integrity="sha512-dTfge/zgoMYpP7QbHy4gWMEGsbsdZeCXz7irItjcC3sPUFtf0kuFbDz/ixG7ArTxmDjLXDmezHubeNikyKGVyQ==" crossorigin="anonymous"&gt;

&lt;!-- Optional theme --&gt;
&lt;link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css" integrity="sha384-aUGj/X2zp5rLCbBxumKTCw2Z50WgIr1vs/PFN4praOTvYXWlVyh2UtNUU0KAUhAX" crossorigin="anonymous"&gt;

&lt;!-- Latest compiled and minified JavaScript --&gt;
&lt;script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js" integrity="sha512-K1qjQ+NcF2TYO/eI3M6v8EiNYZfA95pQumfvcVrTHtwQVDG+aHRqLi/ETn2uB+1JqwYqVG3LIvdm9lj6imS/pQ==" crossorigin="anonymous"&gt;&lt;/script&gt;
</code></pre>
<p class="text-primary">Bien-sûr une fois correctement mappé, faire appel à ce layout dans le rendu des deux actions définies</p>

<h2 id="lien">Lien</h2>
<p>Dans le layout, mettre en place un menu avec les 2 actions définies dans la class DemoController</p>
<p>Afin de récupérer l'url d'une action il suffit d'utiliser le helper twig spécialement fait pour Symfony2 <code>path()</code>, 
qui prend comme premier argument le nom de la route et en second, un tableau <code>{}</code> qui représente les paramètres. </p>
<pre><code>&lt;a href="{{ path('_index') }}"&gt;Go to index&lt;/a&gt;
</code></pre>
<p><strong>En annotation, on définit le nom d'une route comme ci-dessous</strong></p>
<pre><code>/**
 * @Route("/index", name="_index")
 * @Template()
 */
</code></pre>
<p><a href="http://symfony.com/doc/current/book/templating.html#linking-to-pages"><span class="btn btn-info">+ informations</span></a></p>
<h2 id="web-assets">Web Assets</h2>
<p>L'organisation des fichiers dans un projet symfony2 impose que seul le répertoire <code>web</code> est accessible du Web.
Nos fichiers static doivent y être donc stockés afin de les servir au client.</p>
<p>Ces assets, dépendants de nos bundles, doivent être stockés dans <code>src/Lp/TestBunble/Resources/public</code>. Afin de les 
rendre accessible, il faut les publier </p>
<pre><code>$ app/console assets:install --symlink
</code></pre>

<p>L'option <code>-symlink</code> permet de faire un lien symbolique.</p>
<p>Passer les assets appelés dans le layout en CDN par le bundle <code>LpTestBundle</code> en local.</p>
<p><strong>Par exemple</strong></p>
<pre><code>&lt;link rel="stylesheet" href="{{ asset('css/main.css') }}" /&gt; # Stocké dans app/Resources/public/css/main.css
&lt;link rel="stylesheet" href="{{ asset('bundle/lptest/css/main.css') }}" /&gt; # Stocké dans src/Lp/TestBundle/Resources/Public/css/main.css
</code></pre>
<h3 id="assetic">Assetic</h3>
<p>Assetic se basant sur Asset est un Bundle Symfony Framework afin de gérer les fichiers static en les filtrants, comme :</p>
<ul>
<li>Compilé LESS / SAAS / CoffeeScript</li>
<li>Minifiier / Combiné</li>
<li>Optimisation d'images</li>
</ul>
<p><a href="http://symfony.com/doc/current/cookbook/assetic/asset_management.html"><span class="btn btn-info">+ informations</span></a></p>
<h1 id="doctrine">Doctrine</h1>
<h1 id="form">Form</h1></div>
        
    </div>

    <footer class="col-md-12 text-center">
        <hr>
        <p>
        <small>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p></small>
    </footer>

    <script src="../js/jquery-1.10.2.min.js"></script>
    <script src="../js/bootstrap-3.0.3.min.js"></script>
    <script src="../js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script>
    var base_url = '..';
    </script>
    <script data-main="../mkdocs/js/search.js" src="../mkdocs/js/require.js"></script>
    <script src="../js/base.js"></script>
    <script src="../js/main.js"></script>

    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                        <span class="sr-only">Close</span>
                    </button>
                    <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                </div>
                <div class="modal-body">
                    <p>
                        From here you can search these documents. Enter your search terms below.
                    </p>
                    <form role="form">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                        </div>
                    </form>
                    <div id="mkdocs-search-results"></div>
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>

    </body>

</html>
